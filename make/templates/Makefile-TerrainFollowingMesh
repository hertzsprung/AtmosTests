# $1 -- case
# $2 -- noOrography mesh
# $3 -- mountainDict
define TerrainFollowingMesh

$(eval $(call __TerrainFollowingMesh,$1,$2,$3,$(dummy)/$(controlDict)))

endef

# $1 -- case
# $2 -- noOrography mesh
# $3 -- mountainDict
# $4 -- controlDict
define __TerrainFollowingMesh

.INTERMEDIATE: $1.intermediate

$(addprefix $1/,$(meshFiles)): $1.intermediate

$1.intermediate: \
  $1/$(mountainDict) \
  $(addprefix $1/,$(systemFiles)) \
  $(addprefix $2/,$(meshFiles)) \
  $(terrainFollowingMesh) \
| $1/constant
	$(rsync) -ru -delete $2/$(polyMesh) $1/constant
	$(terrainFollowingMesh) -case $1

$(eval $(call CopyFile,$3,$1/$(mountainDict)))
$(eval $(call CopyFile,$4,$1/$(controlDict)))
$(eval $(call CopyNamedFiles,$(dummy),$(fvSchemes) $(fvSolution),$1))
$(eval $(call MakeDir,$1/constant))
$(eval $(call MakeDir,$1/system))

endef
