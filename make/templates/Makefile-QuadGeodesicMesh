# $1 -- case
# $2 -- cells per patch
define QuadGeodesicMesh

$(eval $(call MeshDiagnostics,$1))

.INTERMEDIATE: $1.intermediate

$(addprefix $1/,$(meshFiles)): $1.intermediate

$1.intermediate: \
  $(addprefix $1-block/,$(meshFiles)) \
  $1/$(extrudeMeshDict) \
  $(addprefix $1-block/,$(systemFiles)) \
  $(addprefix $1/,$(systemFiles)) \
| $1/constant
	$(tanPoints) -case $1-block
	$(extrudeMesh) -case $1

$(eval $(call BlockMesh,$1-block,$1/blockMeshDict))

$1/blockMeshDict: \
  src/mesh/quadGeodesicBlockMeshDict \
| $1
	NX=$2 $(envsubst) < $$< > $$@

$1/$(extrudeMeshDict): \
  src/mesh/extrudeGeodesicFromPatch \
| $1/system
	SOURCE_CASE=$1-block $(envsubst) < $$< > $$@

$(eval $(call CopyNamedFiles,$(dummy),$(systemFiles),$1))
$(eval $(call CopyNamedFiles,$(dummy),$(fvSchemes) $(fvSolution),$1-block))
$(eval $(call MakeDir,$1))
$(eval $(call MakeDir,$1/constant))
$(eval $(call MakeDir,$1/system))

endef
