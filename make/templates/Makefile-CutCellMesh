# $1 -- case
# $2 -- ASAM grid definition
define CutCellMesh

.INTERMEDIATE: $1.intermediate

$(addprefix $1/,$(meshFiles)): $1.intermediate

$1.intermediate: \
  $1/vertical_slice.obj \
  $1/$(extrudeMeshDict) \
  $1/$(createPatchDict) \
  $1/$(meshQualityDict) \
  $(addprefix $1/,$(systemFiles)) \
| $1/constant
	$(extrudeMesh) -case $1
	$(setSet) -case $1 -constant -noVTK -batch src/mesh/cutCellPatchSets
	$(createPatch) -case $1 -overwrite

$1/vertical_slice.obj: \
  $1-asam/asam.grid \
| $1-asam \
  $1
	( cd $1-asam && $(asamgrid) asam.grid )
	$(gmvread) $1-asam/asam.out.gmvG $1-asam
	$(gmv2obj) $1-asam $$@

$(eval $(call CopyFile,src/mesh/meshQualityDict,$1/$(meshQualityDict)))
$(eval $(call CopyFile,src/mesh/extrudeMeshDict,$1/$(extrudeMeshDict)))
$(eval $(call CopyFile,src/mesh/createPatchDict,$1/$(createPatchDict)))
$(eval $(call CopyFile,$2,$1-asam/asam.grid))
$(eval $(call CopyNamedFiles,$(dummy),$(systemFiles),$1))
$(eval $(call MakeDir,$1))
$(eval $(call MakeDir,$1/constant))
$(eval $(call MakeDir,$1/system))
$(eval $(call MakeDir,$1-asam))

endef

