# $1 -- case directory
# $2 -- mesh case
# $3 -- velocityFieldDict
# $4 -- timestep
# $5 -- writeInterval
define StandaloneThermalAdvection

$(eval $(call InitialTheta,$1-theta,$2,src/gravityWaves/$(thetaInit),src/gravityWaves/$(environmentalProperties),src/physical/$(thermophysicalProperties),src/gravityWaves/$(fvSchemes),src/gravityWaves/$(fvSolution)))
$(eval $(call ThermalAdvection,$1,$2,$1-theta/0/theta,$3,$4,$5))

endef

# $1 -- case directory
# $2 -- mesh case
# $3 -- theta profile (from the gravityWaves test)
# $4 -- velocityFieldDict
# $5 -- timestep
# $6 -- writeInterval
define ThermalAdvection

all:: $1/18000/T

$(eval $(call ThermalAdvectionSampleLine,$1,18000))
$(eval $(call FieldDiff,$1,18000,T,$1-analyticTracer/18000/T_analytic))
$(eval $(call Errors,$1,18000,T))

$(eval $(call AnalyticThetaField,$1-analyticTracer,$2,$4,src/gravityWaves/constant/environmentalProperties,src/physical/constant/thermophysicalProperties))

$(eval $(call VelocityField,$1-velocity,$2,$4))

$(eval $(call AdvectTracer,$1,$2,$3,$1-velocity/0/phi,18000,$5,$6,src/advection/system/cubicUpwindCPCFit src/advection/system/commonFvSchemes))

endef
#
# $1 -- case
# $2 -- time
define ThermalAdvectionSampleLine

$(eval $(call SampleLine,$1,sampleLine.dat,src/thermalAdvection/system/sampleLine,$2,line_T_diff.xy))

$1/postProcessing/sets/$2/line_T_diff.xy: \
  $1/$2/T_diff

endef

# $1 -- case directory
# $2 -- mesh case
# $3 -- velocityFieldDict
# $4 -- environmentalProperties
# $5 -- thermophysicalProperties
define AnalyticThetaField

$1/18000/T_analytic: \
  $(addprefix $1/,$(meshFiles)) \
  $(addprefix $1/,$(systemFiles)) \
  $1/$(environmentalProperties) \
  $1/$(thermophysicalProperties) \
  $1/$(velocityFieldDict) \
  $(setAdvectedTheta) \
| $1/constant $1/system $1/18000
	$(setAdvectedTheta) -case $1
	mv $1/0/theta $1/18000/T_analytic

$(eval $(call CopyNamedFiles,$2,$(meshFiles),$1))
$(eval $(call CopyNamedFiles,$(dummy),$(systemFiles),$1))
$(eval $(call CopyFile,$3,$1/$(velocityFieldDict)))
$(eval $(call CopyFile,$4,$1/$(environmentalProperties)))
$(eval $(call CopyFile,$5,$1/$(thermophysicalProperties)))

$(eval $(call MakeDir,$1/18000))
$(eval $(call MakeDir,$1/constant))
$(eval $(call MakeDir,$1/system))
$(eval $(call MakeDir,$1/$(polyMesh)))

endef
