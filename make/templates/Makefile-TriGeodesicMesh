# $1 -- case
# $2 -- hexGeodesicMesh case
define TriGeodesicMesh

$(eval $(call MeshDiagnostics,$2-dual))

.INTERMEDIATE: $1.intermediate $2-dual.intermediate

$(addprefix $1/,$(meshFiles)): $1.intermediate
$(addprefix $2-dual/,$(meshFiles)): $2-dual.intermediate

$1.intermediate: \
  $1/$(controlDict) \
  $1/$(extrudeMeshDict) \
  $(addprefix $2-dual/,$(meshFiles)) \
| $1/system
	$(extrudeMesh) -case $1

$1/$(extrudeMeshDict): \
  src/mesh/extrudeGeodesicFromPatch \
| $1/system
	SOURCE_CASE=$2-dual $(envsubst) < $$< > $$@

$2-dual.intermediate: \
  $(addprefix $2-dual/,$(systemFiles)) \
  $(addprefix $2/,$(meshFiles)) \
| $2-dual/constant
	$(rsync) -ru -delete $2/$(polyMesh) $2-dual/constant
	$(polyDualMesh) -case $2-dual -overwrite 90

$(eval $(call CopyNamedFiles,$(dummy),$(controlDict),$1))
$(eval $(call CopyNamedFiles,$(dummy),$(systemFiles),$2-dual))
$(eval $(call MakeDir,$2-dual/constant))
$(eval $(call MakeDir,$2-dual/system))
$(eval $(call MakeDir,$1/system))

endef
