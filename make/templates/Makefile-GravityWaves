schaerWavesEndTime := 18000

# $1 -- case
# $2 -- mesh
# $3 -- timestep
define GravityWaves

$(eval $(call GravityWavesSampleLine,$1,$(schaerWavesEndTime)))
$(eval $(call GravityWavesWContour,$1,$(schaerWavesEndTime)))
$(eval $(call FieldDiff,$1,$(schaerWavesEndTime),theta,$1/0/theta))

$(eval $(call Physical,$1,$2,src/gravityWaves/0/Uf,$1-theta/0/theta,$1-exner/0/Exner,src/gravityWaves/$(environmentalProperties),src/physical/$(thermophysicalProperties),src/gravityWaves/$(fvSchemes),src/gravityWaves/$(fvSolution),$(schaerWavesEndTime),$3,3600,$(exnerFoamH)))
$(eval $(call InitialTheta,$1-theta,$2,src/gravityWaves/$(thetaInit),src/gravityWaves/$(environmentalProperties),src/physical/$(thermophysicalProperties),src/gravityWaves/$(fvSchemes),src/gravityWaves/$(fvSolution)))
$(eval $(call InitialExnerInterpTheta,$1-exner,$2,src/gravityWaves/$(exnerInit),$1-theta/0/theta,src/gravityWaves/$(environmentalProperties),src/physical/$(thermophysicalProperties),src/gravityWaves/$(fvSchemes),src/gravityWaves/$(fvSolution)))

$1.fields.intermediate: $1/$(spongeLayer)

$1/$(spongeLayer): \
  $1/$(environmentalProperties) \
  $(addprefix $1/,$(meshFiles)) \
  $(addprefix $1/,$(systemFiles))
	$(createSpongeLayer) -case $1

endef

# $1 -- case
# $2 -- time
define GravityWavesSampleLine

$(eval $(call SampleLine,$1,sampleLine.dat,src/gravityWaves/system/sampleLine,$2,line_theta_diff.xy))

#$1/postProcessing/sets/$2/line_theta_diff.xy: \
#  $1/$2/theta_diff

endef

# $1 -- case
# $2 -- time
define GravityWavesWContour

$(eval $(call Contour,$1,$2,w,$1/$(schaerWavesEndTime)/w.dat,0.05))

$1/$2/w.dat: $1/$2/Uf.xyz
	tr -s ' ' < $$< | cut -d' ' -f 1,2,3,6 > $$@

$(eval $(call WriteField,$1,$2,Uf))

endef
