# $1 -- resolution
define MountainAdvectionMeshes

$(eval $(call BlockMesh,build/mountainAdvection-mesh-noOrography-$1,src/mountainAdvection/mesh-noOrography-$1))
$(eval $(call TerrainFollowingMesh,build/mountainAdvection-mesh-btf-$1,build/mountainAdvection-mesh-noOrography-$1,src/mountainAdvection/mesh-btf))
$(eval $(call SlantedCellMesh,build/mountainAdvection-mesh-slantedCell-$1,build/mountainAdvection-mesh-noOrography-$1,src/mountainAdvection/mesh-slantedCell))
$(eval $(call CutCellMesh,build/mountainAdvection-mesh-cutCell-$1,src/mountainAdvection/mesh-cutCell-$1,src/mountainAdvection/createPatchDict))

endef

# $1 -- meshType (e.g. btf)
# $2 -- resolution
# $3 -- timestep
define MountainAdvectionTests

$(eval $(call Advection,build/mountainAdvection-$1-cubicUpwind-$2,build/mountainAdvection-mesh-$1-$2,src/mountainAdvection/gaussian,src/mountainAdvection/velocityField,src/advection/system/cubicUpwindCPCFit,$3))
$(eval $(call Advection,build/mountainAdvection-$1-linearUpwind-$2,build/mountainAdvection-mesh-$1-$2,src/mountainAdvection/gaussian,src/mountainAdvection/velocityField,src/advection/system/linearUpwind,$3))

endef

# $1 -- error filename
# $2 -- resolutions
define MountainAdvectionCollation

$(eval $(call Collate,build/mountainAdvection-btf-linearUpwind-,$1,$2))
$(eval $(call Collate,build/mountainAdvection-btf-cubicUpwind-,$1,$2))
$(eval $(call Collate,build/mountainAdvection-slantedCell-linearUpwind-,$1,$2))
$(eval $(call Collate,build/mountainAdvection-slantedCell-cubicUpwind-,$1,$2))
$(eval $(call Collate,build/mountainAdvection-cutCell-linearUpwind-,$1,$2))
$(eval $(call Collate,build/mountainAdvection-cutCell-cubicUpwind-,$1,$2))

all-mountainAdvection-convergence: \
  build/mountainAdvection-btf-linearUpwind-collated/$1 \
  build/mountainAdvection-btf-cubicUpwind-collated/$1 \
  build/mountainAdvection-slantedCell-linearUpwind-collated/$1 \
  build/mountainAdvection-slantedCell-cubicUpwind-collated/$1 \
  build/mountainAdvection-cutCell-linearUpwind-collated/$1 \
  build/mountainAdvection-cutCell-cubicUpwind-collated/$1

endef

$(eval $(call MountainAdvectionMeshes,5000))
$(eval $(call MountainAdvectionMeshes,2500))
$(eval $(call MountainAdvectionMeshes,2000))
$(eval $(call MountainAdvectionMeshes,1250))
$(eval $(call MountainAdvectionMeshes,1000))
$(eval $(call MountainAdvectionMeshes,667))
$(eval $(call MountainAdvectionMeshes,500))
$(eval $(call MountainAdvectionMeshes,333))
$(eval $(call MountainAdvectionMeshes,250))
$(eval $(call MountainAdvectionMeshes,125))

$(eval $(call MountainAdvectionTests,btf,5000,200))
$(eval $(call MountainAdvectionTests,btf,2500,100))
$(eval $(call MountainAdvectionTests,btf,2000,100))
$(eval $(call MountainAdvectionTests,btf,1250,50))
$(eval $(call MountainAdvectionTests,btf,1000,40))
$(eval $(call MountainAdvectionTests,btf,667,25))
$(eval $(call MountainAdvectionTests,btf,500,20))
$(eval $(call MountainAdvectionTests,btf,333,10))
$(eval $(call MountainAdvectionTests,btf,250,10))
$(eval $(call MountainAdvectionTests,btf,125,5))

$(eval $(call MountainAdvectionTests,slantedCell,5000,50))
$(eval $(call MountainAdvectionTests,slantedCell,2500,20))
$(eval $(call MountainAdvectionTests,slantedCell,2000,10))
$(eval $(call MountainAdvectionTests,slantedCell,1250,10))
$(eval $(call MountainAdvectionTests,slantedCell,1000,5))
$(eval $(call MountainAdvectionTests,slantedCell,667,5))
$(eval $(call MountainAdvectionTests,slantedCell,500,2.5))
$(eval $(call MountainAdvectionTests,slantedCell,333,2))
$(eval $(call MountainAdvectionTests,slantedCell,250,1))
$(eval $(call MountainAdvectionTests,slantedCell,125,0.5))

$(eval $(call MountainAdvectionTests,cutCell,5000,3.2))
$(eval $(call MountainAdvectionTests,cutCell,2500,1.6))
$(eval $(call MountainAdvectionTests,cutCell,2000,1))
$(eval $(call MountainAdvectionTests,cutCell,1250,1))
$(eval $(call MountainAdvectionTests,cutCell,1000,1))
$(eval $(call MountainAdvectionTests,cutCell,667,0.4))
$(eval $(call MountainAdvectionTests,cutCell,500,0.4))
$(eval $(call MountainAdvectionTests,cutCell,333,0.2))
$(eval $(call MountainAdvectionTests,cutCell,250,0.2))
$(eval $(call MountainAdvectionTests,cutCell,125,0.1))

$(eval $(call MakeDir,build/mountainAdvection-btf-linearUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-btf-cubicUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-linearUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-cubicUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-linearUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-cubicUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-btf-linearUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-btf-cubicUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-linearUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-cubicUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-linearUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-cubicUpwind-collated/10000/))

$(eval $(call MountainAdvectionCollation,10000/l2errorT.txt,5000 2500 1250 1000 500))
$(eval $(call MountainAdvectionCollation,10000/linferrorT.txt,5000 2500 1250 1000 500))
$(eval $(call MountainAdvectionCollation,0/maxdt.txt,5000 2000 2500 1250 1000 667 500 3333 250 125))
