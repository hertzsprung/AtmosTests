# $1 -- resolution
define MountainAdvectionMeshes

$(eval $(call BlockMesh,build/mountainAdvection-mesh-noOrography-$1,src/mountainAdvection/mesh-noOrography-$1))

$(eval $(call MountainAdvectionFixedHeightMeshes,$1,0))
$(eval $(call MountainAdvectionFixedHeightMeshes,$1,3000))
$(eval $(call MountainAdvectionFixedHeightMeshes,$1,4000))
$(eval $(call MountainAdvectionFixedHeightMeshes,$1,5000))
$(eval $(call MountainAdvectionFixedHeightMeshes,$1,6000))

endef

# $1 -- resolution
# $2 -- mountain height (e.g. 6000)
define MountainAdvectionFixedHeightMeshes

$(eval $(call TerrainFollowingMesh,build/mountainAdvection-mesh-btf-$2-$1,build/mountainAdvection-mesh-noOrography-$1,src/mountainAdvection/mesh-btf-$2))
$(eval $(call SlantedCellMesh,build/mountainAdvection-mesh-slantedCell-$2-$1,build/mountainAdvection-mesh-noOrography-$1,src/mountainAdvection/mesh-slantedCell-$2))
$(eval $(call CutCellMesh,build/mountainAdvection-mesh-cutCell-$2-$1,src/mountainAdvection/mesh-cutCell-$1-$2,src/mountainAdvection/createPatchDict))

endef

# $1 -- meshType (e.g. btf)
# $2 -- mountain height (e.g. 6000)
# $3 -- resolution
# $4 -- timestep
define MountainAdvectionTests

$(eval $(call Advection,build/mountainAdvection-$1-$2-cubicUpwind-$3,build/mountainAdvection-mesh-$1-$2-$3,src/mountainAdvection/schaerRadial,src/mountainAdvection/velocityField-$2,src/advection/system/cubicUpwindCPCFit,$4,src/mountainAdvection/T_init))
$(eval $(call Advection,build/mountainAdvection-$1-$2-linearUpwind-$3,build/mountainAdvection-mesh-$1-$2-$3,src/mountainAdvection/schaerRadial,src/mountainAdvection/velocityField-$2,src/advection/system/linearUpwind,$4,src/mountainAdvection/T_init))

endef

# $1 -- error filename (e.g. 10000/l2errorT.txt)
# $2 -- resolutions
define MountainAdvectionCollateByResolution

$(eval $(call Collate,build/mountainAdvection-btf-6000-linearUpwind-,,$1,$2))
$(eval $(call Collate,build/mountainAdvection-btf-6000-cubicUpwind-,,$1,$2))
$(eval $(call Collate,build/mountainAdvection-slantedCell-6000-linearUpwind-,,$1,$2))
$(eval $(call Collate,build/mountainAdvection-slantedCell-6000-cubicUpwind-,,$1,$2))
$(eval $(call Collate,build/mountainAdvection-cutCell-6000-linearUpwind-,,$1,$2))
$(eval $(call Collate,build/mountainAdvection-cutCell-6000-cubicUpwind-,,$1,$2))

endef

# $1 -- error filename (e.g. 10000/l2errorT.txt)
# $2 -- mountain heights (e.g. 3000 4000 5000)
define MountainAdvectionCollateByMountainHeight

$(eval $(call Collate,build/mountainAdvection-btf-,-linearUpwind-1000,$1,$2))
$(eval $(call Collate,build/mountainAdvection-btf-,-cubicUpwind-1000,$1,$2))
$(eval $(call Collate,build/mountainAdvection-cutCell-,-linearUpwind-1000,$1,$2))
$(eval $(call Collate,build/mountainAdvection-cutCell-,-cubicUpwind-1000,$1,$2))
$(eval $(call Collate,build/mountainAdvection-slantedCell-,-linearUpwind-1000,$1,$2))
$(eval $(call Collate,build/mountainAdvection-slantedCell-,-cubicUpwind-1000,$1,$2))

endef

$(eval $(call MountainAdvectionMeshes,5000))
$(eval $(call MountainAdvectionMeshes,2500))
$(eval $(call MountainAdvectionMeshes,2000))
$(eval $(call MountainAdvectionMeshes,1250))
$(eval $(call MountainAdvectionMeshes,1000))
$(eval $(call MountainAdvectionMeshes,667))
$(eval $(call MountainAdvectionMeshes,500))
$(eval $(call MountainAdvectionMeshes,333))
$(eval $(call MountainAdvectionMeshes,250))
$(eval $(call MountainAdvectionMeshes,125))

$(eval $(call MountainAdvectionTests,btf,0,1000,40))
$(eval $(call MountainAdvectionTests,slantedCell,0,1000,40))
$(eval $(call MountainAdvectionTests,cutCell,0,1000,40))
$(eval $(call MountainAdvectionTests,btf,3000,1000,16))
$(eval $(call MountainAdvectionTests,slantedCell,3000,1000,8))
$(eval $(call MountainAdvectionTests,cutCell,3000,1000,1.6))
$(eval $(call MountainAdvectionTests,btf,4000,1000,10))
$(eval $(call MountainAdvectionTests,slantedCell,4000,1000,6.25))
$(eval $(call MountainAdvectionTests,cutCell,4000,1000,1.6))
$(eval $(call MountainAdvectionTests,btf,5000,1000,8))
$(eval $(call MountainAdvectionTests,slantedCell,5000,1000,5))
$(eval $(call MountainAdvectionTests,cutCell,5000,1000,0.5))

$(eval $(call MountainAdvectionTests,btf,6000,5000,198))
$(eval $(call MountainAdvectionTests,btf,6000,2500,60))
$(eval $(call MountainAdvectionTests,btf,6000,2000,38))
$(eval $(call MountainAdvectionTests,btf,6000,1250,18))
$(eval $(call MountainAdvectionTests,btf,6000,1000,5)) # 13 for Co~1
$(eval $(call MountainAdvectionTests,btf,6000,667,8))
$(eval $(call MountainAdvectionTests,btf,6000,500,6.25))
$(eval $(call MountainAdvectionTests,btf,6000,333,4))
$(eval $(call MountainAdvectionTests,btf,6000,250,3))
$(eval $(call MountainAdvectionTests,btf,6000,125,0.5))

$(eval $(call MountainAdvectionTests,slantedCell,6000,5000,145))
$(eval $(call MountainAdvectionTests,slantedCell,6000,2500,40))
$(eval $(call MountainAdvectionTests,slantedCell,6000,2000,22))
$(eval $(call MountainAdvectionTests,slantedCell,6000,1250,11))
$(eval $(call MountainAdvectionTests,slantedCell,6000,1000,4)) # 9 for Co~1
$(eval $(call MountainAdvectionTests,slantedCell,6000,667,5.5))
$(eval $(call MountainAdvectionTests,slantedCell,6000,500,4))
$(eval $(call MountainAdvectionTests,slantedCell,6000,333,2.5))
$(eval $(call MountainAdvectionTests,slantedCell,6000,250,1.75))
$(eval $(call MountainAdvectionTests,slantedCell,6000,125,0.5))

$(eval $(call MountainAdvectionTests,cutCell,6000,5000,135))
$(eval $(call MountainAdvectionTests,cutCell,6000,2500,13))
$(eval $(call MountainAdvectionTests,cutCell,6000,2000,4))
$(eval $(call MountainAdvectionTests,cutCell,6000,1250,1.5))
$(eval $(call MountainAdvectionTests,cutCell,6000,1000,1.5)) # 3.333 for Co~1
$(eval $(call MountainAdvectionTests,cutCell,6000,667,0.333))
$(eval $(call MountainAdvectionTests,cutCell,6000,500,0.3))
$(eval $(call MountainAdvectionTests,cutCell,6000,333,0.12))
$(eval $(call MountainAdvectionTests,cutCell,6000,250,0.11))
$(eval $(call MountainAdvectionTests,cutCell,6000,125,0.1))

$(eval $(call MountainAdvectionCollateByResolution,10000/l2errorT.txt,5000 2500 2000 1250 1000 667 500 333 250))
$(eval $(call MountainAdvectionCollateByResolution,10000/linferrorT.txt,5000 2500 2000 1250 1000 667 500 333 250))
$(eval $(call MountainAdvectionCollateByResolution,0/maxdt.txt,5000 2500 2000 1250 1000 667 500 333 250 125))

$(eval $(call MountainAdvectionCollateByMountainHeight,10000/l2errorT.txt,0 3000 4000 5000 6000))
$(eval $(call MountainAdvectionCollateByMountainHeight,10000/linferrorT.txt,0 3000 4000 5000 6000))

$(eval $(call MakeDir,build/mountainAdvection-btf-6000-linearUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-btf-6000-cubicUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-6000-linearUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-6000-cubicUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-6000-linearUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-6000-cubicUpwind-collated/0/))
$(eval $(call MakeDir,build/mountainAdvection-btf-6000-linearUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-btf-6000-cubicUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-6000-linearUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-6000-cubicUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-6000-linearUpwind-collated/10000/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-6000-cubicUpwind-collated/10000/))

$(eval $(call MakeDir,build/mountainAdvection-btf-collated-linearUpwind-1000/10000/))
$(eval $(call MakeDir,build/mountainAdvection-btf-collated-cubicUpwind-1000/10000/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-collated-linearUpwind-1000/10000/))
$(eval $(call MakeDir,build/mountainAdvection-cutCell-collated-cubicUpwind-1000/10000/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-collated-linearUpwind-1000/10000/))
$(eval $(call MakeDir,build/mountainAdvection-slantedCell-collated-cubicUpwind-1000/10000/))
